<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ultimate Mobile IDE v2</title>

<!-- CodeMirror -->
<link rel="stylesheet"
href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.css">
<link rel="stylesheet"
href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/theme/material.min.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/javascript/javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/xml/xml.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/css/css.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/python/python.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/sql/sql.min.js"></script>

<script src="https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/sql-wasm.js"></script>

<style>
body{
margin:0;
background:#121212;
color:white;
font-family:monospace;
display:flex;
flex-direction:column;
height:100vh;
}

header{
padding:10px;
background:#1e1e1e;
text-align:center;
font-weight:bold;
}

.tabs{
display:flex;
flex-wrap:wrap;
}

.tab{
padding:8px 12px;
background:#1e1e1e;
border:1px solid #333;
cursor:pointer;
}

.tab.active{
background:#007acc;
}

button{
padding:6px;
background:#1e1e1e;
color:white;
border:1px solid #333;
margin:3px;
}

#terminal{
height:180px;
background:black;
padding:10px;
overflow:auto;
font-size:14px;
}

.success{color:#00ff88;}
.error{color:#ff4c4c;}
.info{color:#4da6ff;}
.warning{color:#ffcc00;}

table{
border-collapse:collapse;
width:100%;
margin-top:5px;
}

td,th{
border:1px solid #555;
padding:5px;
}
</style>
</head>

<body>

<header>Ultimate Mobile IDE v2</header>

<div class="tabs">
<div class="tab active" onclick="switchTab('html',this)">HTML</div>
<div class="tab" onclick="switchTab('css',this)">CSS</div>
<div class="tab" onclick="switchTab('js',this)">JS</div>
<div class="tab" onclick="switchTab('python',this)">Python</div>
<div class="tab" onclick="switchTab('sql',this)">SQL</div>
</div>

<textarea id="code"></textarea>

<div>
<button onclick="runCode()">Run</button>
<button onclick="clearTerminal()">Clear</button>
<button onclick="toggleTheme()">Toggle Theme</button>
</div>

<iframe id="preview" style="height:200px;border:none;"></iframe>
<div id="terminal"></div>

<script>
let currentTab="html";
let pyodide;
let db;
let dark=true;

let codeData={
html:"<h1>Hello Raj</h1>",
css:"h1{color:red;}",
js:"",
python:"print('Hello Raj')",
sql:""
};

const editor=CodeMirror.fromTextArea(document.getElementById("code"),{
lineNumbers:true,
mode:"xml",
theme:"material"
});

editor.setValue(codeData[currentTab]);

async function init(){
pyodide=await loadPyodide();

const SQL=await initSqlJs({
locateFile:file=>
`https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/${file}`
});
db=new SQL.Database();
}
init();

function switchTab(tab,el){
codeData[currentTab]=editor.getValue();
currentTab=tab;
editor.setValue(codeData[tab]);

if(tab==="html")editor.setOption("mode","xml");
if(tab==="css")editor.setOption("mode","css");
if(tab==="js")editor.setOption("mode","javascript");
if(tab==="python")editor.setOption("mode","python");
if(tab==="sql")editor.setOption("mode","sql");

document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
el.classList.add("active");
}

function log(msg,type){
const div=document.createElement("div");
div.className=type;
div.innerHTML=msg;
document.getElementById("terminal").appendChild(div);
}

function clearTerminal(){
document.getElementById("terminal").innerHTML="";
}

function toggleTheme(){
dark=!dark;
editor.setOption("theme",dark?"material":"default");
}

function updatePreview(){
const full=`
<html>
<head><style>${codeData.css}</style></head>
<body>
${codeData.html}
<script>${codeData.js}<\/script>
</body>
</html>`;
document.getElementById("preview").srcdoc=full;
}

async function runCode(){

codeData[currentTab]=editor.getValue();

if(currentTab==="html"||currentTab==="css"||currentTab==="js"){
updatePreview();
log("Preview Updated","success");
}

/* -------- PYTHON -------- */
if(currentTab==="python"){
try{

pyodide.runPython(`
import sys
from io import StringIO
sys.stdout = StringIO()
`);

await pyodide.runPythonAsync(editor.getValue());

let printed = pyodide.runPython("sys.stdout.getvalue()");

if(printed){
log(printed.trim(),"success");
}else{
log("Execution completed.","info");
}

}catch(err){
log(err,"error");
log("Check syntax or indentation.","warning");
}
}

/* -------- SQL (Selected Only) -------- */
if(currentTab==="sql"){
try{

let selected = editor.getSelection();
let sqlCode = selected ? selected : editor.getValue();

let result = db.exec(sqlCode);

if(result.length===0){
log("Query executed successfully.","success");
}else{

let table="<table><tr>";

result[0].columns.forEach(col=>{
table+="<th>"+col+"</th>";
});

table+="</tr>";

result[0].values.forEach(row=>{
table+="<tr>";
row.forEach(cell=>{
table+="<td>"+cell+"</td>";
});
table+="</tr>";
});

table+="</table>";

log(table,"info");
}

}catch(err){
log(err,"error");
log("Check SQL syntax.","warning");
}
}

}
</script>

</body>
</html>
